#the experiments folder is for experiments with libs and coffeescript
#this cakefile is to build this experimental code, for general semantictasks build consider cakefile in the root directory


#VARIABLES
#----------

#child process variable
{exec} = require 'child_process'

#path where to take files from
path = "./"

#output path where to store compiled js files
out = path+"js/"

#app main file name
app = "test.coffee"


coffees = "*.coffee"

#path to our collaboration classes
collab = path+"collab"
#js file name to which the collab classes will be compiled
collabFile = out+"collab.js"

jsFile = out + "test.js"




compile = ->
  console.log "Compilation started"
  #compiles and joins models in single js file
  exec "coffee --join #{collabFile} --compile --output #{out} #{collab}", (err, stdout, stderr) ->
    #throws errors if there are any
    throw err if err
    #prints log
    console.log stdout + stderr

  #compiles an app
  exec "coffee  --compile --output #{out} #{app}", (err, stdout, stderr) ->
    #throws errors if there are any
    throw err if err
    #prints log
    console.log stdout + stderr

  console.log "Compilation completed"


test = ->
  console.log "Testing started"
  #testing is described here http://net.tutsplus.com/tutorials/javascript-ajax/better-coffeescript-testing-with-mocha/
  exec "mocha --compilers coffee:coffee-script", (err, stdout, stderr) ->
    #throws errors if there are any
    throw err if err
    #prints log
    console.log stdout + stderr

  console.log "Testing completed"


build = ->
  compile()
  test()

#makes compilation
task 'compile', 'Compiles coffeescript files in the project and moves them to output dir', ->
  compile()


#makes compilation
task 'test', 'Test everything', ->
  test()



#makes cleanup,compile and documenting
task 'build', 'Builds project from src/*.coffee to lib/*.js', ->
  console.log "Build task started"

  compile()
  test()
  #  makeDocs()
  console.log "Build task completed"


